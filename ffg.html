<!DOCTYPE html>
<html>
<head>
    <title>Booking Appointment</title>
    <style>
        /* Your CSS styles here */
    </style>
</head>
<body>
    <div class="container">
        <h1>Booking Appointment</h1>
        <form id="bookingForm">
            <!-- Your form fields here -->
            <button type="submit">Book Appointment</button>
        </form>
    </div>

    <div id="userList" class="container">
        <h2>Booked Appointments</h2>
        <ul id="users"></ul>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const crudApiUrl = 'https://crudcrud.com/api/58d3da618134487b9c1eb1996b82e718';
            const bookingForm = document.getElementById('bookingForm');
            const userList = document.getElementById('users');
            let editingUserId = null;

            bookingForm.addEventListener('submit', function(event) {
                event.preventDefault();
                const name = document.getElementById('name').value;
                const email = document.getElementById('email').value;
                const date = document.getElementById('date').value;

                if (editingUserId) {
                    // Edit existing user
                    fetch(`${crudApiUrl}/users/${editingUserId}`, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name, email, date })
                    })
                    .then(response => response.json())
                    .then(() => {
                        editingUserId = null;
                        bookingForm.reset();
                        loadUsers();
                    })
                    .catch(error => {
                        console.error('Error editing user details:', error);
                    });
                } else {
                    // Create new user
                    fetch(`${crudApiUrl}/users`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ name, email, date })
                    })
                    .then(response => response.json())
                    .then(() => {
                        bookingForm.reset();
                        loadUsers();
                    })
                    .catch(error => {
                        console.error('Error creating user:', error);
                    });
                }
            });

            function loadUsers() {
                fetch(`${crudApiUrl}/users`)
                    .then(response => response.json())
                    .then(data => {
                        displayUserDetails(data);
                    })
                    .catch(error => {
                        console.error('Error fetching user details:', error);
                    });
            }

            function displayUserDetails(users) {
                userList.innerHTML = users.map(user => `
                    <li>
                        Name: ${user.name}, Email: ${user.email}, Date: ${user.date}
                        <span class="edit-icon" data-id="${user._id}">&#x270E;</span>
                        <span class="delete-icon" data-id="${user._id}">&#x274C;</span>
                    </li>`).join('');

                const editIcons = document.querySelectorAll('.edit-icon');
                editIcons.forEach(icon => {
                    icon.addEventListener('click', editUser);
                });

                const deleteIcons = document.querySelectorAll('.delete-icon');
                deleteIcons.forEach(icon => {
                    icon.addEventListener('click', deleteUser);
                });
            }

            function editUser(event) {
                const userId = event.target.getAttribute('data-id');

                fetch(`${crudApiUrl}/users/${userId}`)
                    .then(response => response.json())
                    .then(user => {
                        document.getElementById('name').value = user.name;
                        document.getElementById('email').value = user.email;
                        document.getElementById('date').value = user.date;
                        editingUserId = userId;
                    })
                    .catch(error => {
                        console.error('Error fetching user details:', error);
                    });
            }

            function deleteUser(event) {
                const userId = event.target.getAttribute('data-id');

                fetch(`${crudApiUrl}/users/${userId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    loadUsers();
                })
                .catch(error => {
                    console.error('Error deleting user:', error);
                });
            }

            loadUsers();
        });
    </script>
</body>
</html>
